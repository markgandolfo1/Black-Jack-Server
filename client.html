<!DOCTYPE html>
<html>
   <head>
        <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
        <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
        <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
      <script src="/socket.io/socket.io.js"></script>
      <script type ="text/babel">
      
      
        let games = [];
        let test;
        let hi = "hi";
        let gamescounter = 0; //MIGHT NEED TO CHANGE THIS WITH A NEWCONNECT();
        var socketio = io.connect();
        
        //newconnect();

class Game extends React.Component {
    constructor(props) {
    super(props);
    this.state = {deck: createdeck(),
        players: 2, //make an array of player objects, containing cards for each
        newround: true, //so you know when to shuffle deck
        games: this.props.games,
        currentgamenumber: 0
        };
      }

      msg(newgames, newcurrentgamenumber){
        console.log("bjvek");
        console.log("player:" + newgames[newcurrentgamenumber].players[0]);
        this.setState({games: newgames, currentgamenumber: newcurrentgamenumber});
    }

render(){
    socketio.on("updategamesgame", (data) => {
        // console.log("player:" + data["games"][data["currentgamenumber"]].players[0]);
        this.msg(data["games"], data["currentgamenumber"]);
    })

        let gamesarray = [];

        for(let i=0; i<this.state.games.length; i++){
            gamesarray.push(
            <div>
            {this.state.games[i].creator}
            </div>
);
        }
        if(this.props.create){
 
        return (
            <div>
                {this.state.deck[0].rank}
                {this.state.games.length}
                {gamesarray}

            </div>
        );
        }
        else{
            return (
            <div>
                {this.state.deck[0].rank}
                {this.state.games.length}
                {gamesarray}
                Players:
                {this.state.games[this.state.currentgamenumber].players[0]}
            </div>
        );  
        }
    }
}

function Buttons(props) {
return(
    <button className="creategame" onClick={props.onClick}>
        Create New Game
    </button>
)
}

class Login extends React.Component {
    constructor(props) {
        super(props);
        this.state = {clicked_creategame: false,
                    clicked_joingame: false,
                    currentgame: this.props.username,
                    numberofgames:0,
                    games:this.props.games
        };
      }
    handleClick(){
        this.setState({clicked_creategame: true, 
            numberofgames: this.numberofgames+1 })
    }
    renderButtons(){
        return(
            <Buttons
            onClick={() => this.handleClick()}
            />
        )
    }

    msg(newgames, newcurrentgamenumber){
        console.log("bjvek");
        console.log("player:" + newgames[newcurrentgamenumber].players[0]);
        this.setState({games: newgames, currentgamenumber: newcurrentgamenumber});
    }

render(){
    socketio.on("updategames", (data) => {
        this.msg(data["games"], data["currentgamenumber"]);
    })

//YOU CREATED A GAME:
if (this.state.clicked_joingame) {
    socketio.emit("joinroom",{player: this.props.username, currentgame: this.state.currentgame, createdgame: this.state.clicked_creategame});

    return (
        <Game
            username={this.props.username}
            create={this.state.clicked_creategame}
            games={this.state.games}
            // game={this.state.games[this.state.currentgamenumber]}
        />
    );
}

// YOU ARE IN LOBBY AND THERE ARE GAMES:
else{ 

        let gamesarray = [];

        for(let i=0; i<this.state.games.length; i++){
            gamesarray.push(
            <button className={this.state.games[i].creator} onClick={() => this.setState({clicked_joingame: true, currentgame: this.state.games[i].creator})}>
                {this.state.games[i].creator}
            </button>
);
        }
        return(

        //MAKE JOIN BTNS HERE
        <div>

        <button className={this.state.games.length} onClick={() => this.setState({clicked_creategame: true, clicked_joingame: true, currentgame: this.props.username})}>
            Create New Game
        </button>

        {gamesarray}

        </div>
    );
    } 
}
}

class Account extends React.Component {
    constructor(props) {
    super(props);
    this.state = {clicked_login: false,
                 clicked_create: false,
                games: this.props.games};
  }
  msg(newgames){     
        this.setState({games: newgames});
    }
    
render(){
    socketio.on("updategamesaccount", (data) => {
        this.msg(data["games"]);
    })
    if (this.state.clicked_login) {
        socketio.emit("joinlobby", {user:document.getElementById("username_input").value});
        socketio.emit("newConnection", {user:document.getElementById("username_input").value});
        return (
            <Login
                username={document.getElementById("username_input").value}
                games = {this.state.games}
                // onClick={() => this.handleClick()}
            />
        );
        }
    if (this.state.clicked_create) {
        return 'You clicked create.';
    }
    return (
        <div>
        <input type="text" id="username_input" placeholder="Username"/>
        <button className="login" onClick={() => this.setState({clicked_login: true })}>
            Login
        </button>
        <button className="create" onClick={() => this.setState({clicked_create: true })}>
            Create
        </button>
        </div>
    )
  }
}

socketio.on("games", function(data){
        games = data["games"];
        test = data["test"];
        
ReactDOM.render(
    <Account 
    games = {games}
    />,
    document.getElementById('s')
  );
    });
function createdeck(){
    let deck = [];
    let s = 1;
    for(let i=0; i<52; i=i+4){
        deck[i] = new Object();
        deck[i].rank = s;
        deck[i].suit = "diamonds";
        deck[i+1] = new Object();
        deck[i+1].rank = s;
        deck[i+1].suit = "clubs";
        deck[i+2] = new Object();
        deck[i+2].rank = s;
        deck[i+2].suit = "hearts";
        deck[i+3] = new Object();
        deck[i+3].rank = s;
        deck[i+3].suit = "spades";
s++
    }
    return deck;
}
 //adapted from Professor Cytron in CSE 131
// function shuffle (oldDeck) {
//     let newDeck = new Array(52);
// 		for (let i=newDeck.length-1; i>=0; --i) {
// 			let c = parseInt((Math.random() * (i+1)));
// 			newDeck[i] = oldDeck[c];
// 			for (let j=c; j<newDeck.length-1; ++j) {
// 				oldDeck[j] = oldDeck[j+1];}}
// 		for(let i=0; i<52; i++) {
// 			oldDeck[i] = newDeck[i];
// 		}
//     }
        // function newconnect(person){
        //     socketio.emit("newConnection", {user:person});
        // }
   
    // function getGames(){
    //     socketio.on("joinroombtn", function(data){
    //     games = data["games"];
    //     test = data["test"];
    //     console.log("yeeeee");         
    // });
    // }
      </script>
   </head>
   <body>
        <div id="s"></div>
        <!-- <script type="text/babel" src="two.js"></script> -->

   </body>
</html>
<!DOCTYPE html>
<html>
   <head>
        <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
        <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
        <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
      <script src="/socket.io/socket.io.js"></script>
      <script type ="text/babel">
      
      
        let games = [];
        let test;
        let hi = "hi";
        let gamescounter = 0; //MIGHT NEED TO CHANGE THIS WITH A NEWCONNECT();
        var socketio = io.connect();
        
        //newconnect();

class Game extends React.Component {
    constructor(props) {
    super(props);
    this.state = {deck: createdeck(),
        players: 2, //make an array of player objects, containing cards for each
        newround: true, //so you know when to shuffle deck
        currentgames: getGames()
        };
      }

    render() {
 
        return (
            <div>
                {this.state.deck[0].rank}
                
                {this.state.currentgames}
            </div>
        );
    }
}

class Login extends React.Component {
    constructor(props) {
        super(props);
        this.state = {clicked_creategame: false,
                    numberofgames:0
        };
      }

    // updatenumberofgames(){
    //     this.setState({numberofgames: this.numberofgames+1 })
    //   }

render(){
    
    if (this.state.clicked_creategame) {

    socketio.emit("newroom",{creator:this.props.username});
    //updatenumberofgames();
    //this.state.numberofgames++;

    return (
        <Game
            username={this.props.username}
        />
    );    
    }

    else if(this.props.games.length!=0){
        let gamesarray = [];

        for(let i=0; i<games.length; i++){
            gamesarray.push(
            <button className="game">
                {this.props.games[i].creator}
            </button>
);
        }

        return(
        //MAKE JOIN BTNS HERE
        <div>
        <button className="creategame" onClick={() => this.setState({clicked_creategame: true })}>
            Create New Game
        </button>

        {gamesarray}

        </div>
    );
    }
    else{
    return(
        <div>
        <button className="creategame" onClick={() => this.setState({clicked_creategame: true })}>
            Create New Game
        </button>

        </div>
    );}
}
}

class Account extends React.Component {
    constructor(props) {
    super(props);
    this.state = {clicked_login: false,
                 clicked_create: false};
  }

  render() {
    if (this.state.clicked_login) {
        socketio.emit("joinlobby", {user:document.getElementById("username_input").value});
        socketio.emit("newConnection", {user:document.getElementById("username_input").value});
        return (
            <Login
                username={document.getElementById("username_input").value}
                games = {this.props.games}
                // onClick={() => this.handleClick()}
            />
        );
        }

    if (this.state.clicked_create) {
        return 'You clicked create.';
    }

    return (
        <div>
        <input type="text" id="username_input" placeholder="Username"/>

        <button className="login" onClick={() => this.setState({clicked_login: true })}>
            Login
        </button>

        <button className="create" onClick={() => this.setState({clicked_create: true })}>
            Create
        </button>
        </div>
    )
  }
}

socketio.on("games", function(data){
        games = data["games"];
        test = data["test"];
        
ReactDOM.render(
    <Account 
    games = {games}
    />,
    document.getElementById('s')
  );
    });

function createdeck(){
    let deck = [];
    let s = 1;
    for(let i=0; i<52; i=i+4){
        deck[i] = new Object();
        deck[i].rank = s;
        deck[i].suit = "diamonds";

        deck[i+1] = new Object();
        deck[i+1].rank = s;
        deck[i+1].suit = "clubs";

        deck[i+2] = new Object();
        deck[i+2].rank = s;
        deck[i+2].suit = "hearts";

        deck[i+3] = new Object();
        deck[i+3].rank = s;
        deck[i+3].suit = "spades";
s++
    }
    return deck;
}

 //adapted from Professor Cytron in CSE 131
// function shuffle (oldDeck) {
//     let newDeck = new Array(52);
// 		for (let i=newDeck.length-1; i>=0; --i) {
// 			let c = parseInt((Math.random() * (i+1)));
// 			newDeck[i] = oldDeck[c];
// 			for (let j=c; j<newDeck.length-1; ++j) {
// 				oldDeck[j] = oldDeck[j+1];}}
// 		for(let i=0; i<52; i++) {
// 			oldDeck[i] = newDeck[i];
// 		}
//     }

        // function newconnect(person){
        //     socketio.emit("newConnection", {user:person});
        // }

    
      
      socketio.on("joinroombtn", function(data){
        games = data["games"];
        test = data["test"];
        console.log("ye" + games[0].creator + " " + test);
        
    });

   

    function getGames(){
        
    }




      </script>
   </head>
   <body>
        <div id="s"></div>
        <!-- <script type="text/babel" src="two.js"></script> -->

   </body>
</html>